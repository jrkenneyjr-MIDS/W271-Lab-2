---
title: "Lab 02"
author: "Alex Yang, John Kenney, Ram Balasubramanian"
subtitle: "w271"
date: "Oct 12, 2017"
output: pdf_document
fontsize: 11pt
geometry: margin=0.75in
---

#Introduction:  
We have been hired by a Private University to identify who among their Alumni are most likely to contribute towards the University's foundation in future years. The university has provided us with data on past contributions from graduates - data includes some demographic information (like gender, marital status etc.), some university specific information (graduation year, major of studies), and some post-graduation information (Alumni event attendance, historical contributions).  
## We have taken two approaches to the problem (named Beta-Hat and Y-Hat):  
##Approach Beta-Hat:
We will treat the problem as a "explanation" problem ($\hat{\beta}$).  The goal here is to figure out if and how much certain aspects of a person and their association with the university determines how much they will contribute to the university's foundation.  We will develop a regression model that considers the 2016 contributions as a variable that depends on one or more of the other data elements that have been provided.  The regression coefficients can then be interpreted as a measure of how much each aspect of a person influences their contributions.  

##Approach Y-Hat:  
We will treat the problem as a "prediction" problem ($\hat{y}$ problem).  Given all the data we have about a person and their past contributions, can we predict how much they will contribute in the future.  We will develop a model that aims to predict the 2016 contribution amounts for each person.  To evaluate the efficacy of our models, we will split the data into a "training" set and a "test" set. We will use the training data to estimate parameters for our prediction model and evaluate our model's prediction accuracy using the test set.  




```{r}
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)

#Libraries required 
library(car)
library(dplyr)
library(Hmisc)#Used by author for 3D plotting
library(ggplot2)
library(gridExtra)
library(effsize) #Used to calculate Cohen's D for T-Test
library(aod)    #Used for effect size of the logit model
library(mcprofile) #Used for confidence intervals

library(data.table)
```

### Read Data

```{r}
dt<-fread("lab2data.csv")
describe(dt)
```

We do not have any missing values in the data; and there do not seem to be an obvious "data cleaning" that needs to be conducted.  We will conduct an Exploratory Data Analysis next.  

# Exploratory Data Analysis:  

##Univariate Analysis:  
Let's examine each variable first starting with the "variable of interest" - 2016 contributions.

FY16Giving: Given that the vast majority of people did not give in 2016 and the skewness of the data (with a few large contributions) - let's also look at the distribution after a log-transformation (this is something we may want to consider for our modeling purposes)  



```{r}

h1 = ggplot(data=dt,aes(x=FY16Giving)) +
  geom_histogram(bins=20) +
  ggtitle("Dist. of 2016 Contributions \n All Only $ Scale") + 
  theme(plot.title = element_text(lineheight=1))
h2 = ggplot(data=dt,aes(x=log10(FY16Giving))) +
  geom_histogram(bins=20) +
  ggtitle("Dist. of 2016 Contributions\n All - Log10 $ Scale") +
  xlab("Log10 Contributions")
  theme(plot.title = element_text(lineheight=1, face="bold"))
  
grid.arrange(h1,h2,ncol=2)

```

Most of the alumni contributed \$0; so we see a big spike at 0 and then it tapers off quickly.  Let's do a log-transformation to see the distribution more clearly (note: 0 contributions are excluded in the log-transformed plot). The log-transformed distribution looks somewhat normal - with a few contributions in the tens of thousands of dollars.  

Let's look at a distribution of just the "givers" (i.e. take out the zero contributions) to get a better picture.  

```{r}

h1 = ggplot(data=dt[FY16Giving>0],aes(x=FY16Giving)) +
  geom_histogram(bins=20) +
  ggtitle("Dist. of 2016 Contributions \nGivers Only $ Scale") + 
  theme(plot.title = element_text(lineheight=1))
h2 = ggplot(data=dt[FY16Giving>0],aes(x=log10(FY16Giving))) +
  geom_histogram(bins=20) +
  ggtitle("Dist. of 2016 Contributions\nGivers Only - Log10 $ Scale") +
  xlab("Log10 Contributions")
  theme(plot.title = element_text(lineheight=1, face="bold"))
  
grid.arrange(h1,h2,ncol=2)

```
Distribution on the left shows that there are many who contribute very small amounts.  So the distribution is still very skewed; so a log-transform might help us see the distribution better.

Let's group the 2016 contributions by the categories that the university is interested in. 

```{r}
dt$FY16GivingCat<-cut(dt$FY16Giving,c(0,1,100,250,500,200000),right=FALSE)
#summary(dt$FY16GivingCat)
describe(dt$FY12GivingCat)
```

Let's do it for other years as well to see how the distributions look.

```{r}
dt$FY15GivingCat<-cut(dt$FY15Giving,c(0,1,100,250,500,200000),right=FALSE)
describe(dt$FY15GivingCat)
dt$FY14GivingCat<-cut(dt$FY14Giving,c(0,1,100,250,500,200000),right=FALSE)
describe(dt$FY14GivingCat)
dt$FY13GivingCat<-cut(dt$FY13Giving,c(0,1,100,250,500,200000),right=FALSE)
describe(dt$FY13GivingCat)
dt$FY12GivingCat<-cut(dt$FY12Giving,c(0,1,100,250,500,200000),right=FALSE)
describe(dt$FY12GivingCat)

```

Each year, roughly half the alumni population do not give anything.  20-25%% give less than \$100;  Around 14% Give \$100-250; About 4% give \$250-500 and less than 1% give more than $500.  In 2013, we had the highest percentage of the Alumni contributing (about 49%) and 2015 marked the lowest % giving (43%)


##Bivariate Analysis:  

###Giving in 2016 vs. 2015:  
Let's look at how 2016 giving relates to 2015.  The plot shows that there is a reasonable correlation between the two (note the density of dots along the diagonal)

```{r}
plot(jitter(as.numeric(FY16GivingCat),2)~jitter(as.numeric(FY15GivingCat),1.5),data=dt,pch=20)
```

###Giving in 2016 vs. Alumni Event Attendance:  

```{r}
ggplot(dt,aes(factor(AttendenceEvent),as.numeric(FY16GivingCat))) +
  geom_boxplot(aes(fill=factor(AttendenceEvent))) +
  ggtitle("Giving Category by Attendance at Event") +
  geom_jitter() +
  scale_x_discrete(name="Attendance",labels=c("No","Yes"))+
  scale_y_continuous(name="Giving Category",breaks=1:5,labels=c("[0,1)","[1,100)","[100,250)",
                                                                "[250,500)","[500,2e+05)")) +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```
So there does seem to be a relationship between giving in 2016 and attendence at alumni events.

###Giving in 2016 by  Marital status:  


```{r}
ggplot(dt,aes(factor(Marital.Status),as.numeric(FY16GivingCat))) +
  geom_boxplot(aes(fill=factor(Marital.Status))) +
  ggtitle("Giving Category by Marital Status") +
  geom_jitter() +
  scale_x_discrete(name="Marital Status",labels=c("Divorced","Married","Single","Widowed"))+
  scale_y_continuous(name="Giving Category",breaks=1:5,labels=c("[0,1)","[1,100)","[100,250)",
                                                                "[250,500)","[500,2e+05)")) +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```

Most of the Alumni fall into either Married or Single category and it appears like Married Alumni are more likely to give than single.  
There are very few data points for Widowed and Single alumni - so we do not want to make broad conclusions, but it appear that there are both single and Widowed Alumni that contribute high amounts (and there are those that contribute nothing too in these categories)
One possible reason we are seeing this pattern (married giving more than single) might actually have to do with age.  Older Alumni are more likely to be married and older alumni are also probably a bit more well established financially - so more likely to contribute to charitable causes. So Marital status vs. Giving might simply be capturing the relationship between Age and Giving. While age is not a variable that's available in the dataset, we have "Class Year" which is a good proxy for age.  


### Giving 2016 vs. Class Year:  

```{r}
ggplot(dt,aes(factor(Class.Year),as.numeric(FY16GivingCat))) +
  geom_boxplot(aes(fill=factor(Class.Year))) +
  ggtitle("Giving Category by Class Year") +
  geom_jitter() +
  scale_x_discrete(name="Class Year")+
  scale_y_continuous(name="Giving Category",breaks=1:5,labels=c("[0,1)","[1,100)","[100,250)",
                                                                "[250,500)","[500,2e+05)")) +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```
Here, it indeed looks like the older the alumnus, the more likely he or she is to give money.Unfortunately, the boxplot by category misses a lot of data, so we can try to instead do a boxplot of the log of 2016 giving, minus the people who donated nothing.  

```{r}
ggplot(dt[FY16Giving>0],aes(factor(Class.Year),log10(FY16Giving))) +
  geom_boxplot(aes(fill=factor(Class.Year))) +
  ggtitle("Log(base10) Giving by Class Year") +
  geom_jitter() +
  scale_x_discrete(name="Class Year")+
  scale_y_continuous(name="Log(base 10) Giving") +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```

So for those who do donate, there seems to a clear trend that older alumni donate more. 

### Giving in 2016 by Gender:  

```{r}
ggplot(dt,aes(Gender,as.numeric(FY16GivingCat))) +
  geom_boxplot(aes(fill=Gender)) +
  ggtitle("Giving Category by Class Year") +
  geom_jitter() +
  scale_x_discrete(name="Gender")+
  scale_y_continuous(name="Giving Category",breaks=1:5,labels=c("[0,1)","[1,100)","[100,250)",
                                                                "[250,500)","[500,2e+05)")) +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```
It's a little hard to tell- since it does look like men donate a bit more to the university, but it's also possible that there are fewer female alumni (fewer women attended college in 1972)  



```{r}
ggplot(dt[FY16Giving>0],aes(Gender,log10(FY16Giving))) +
  geom_boxplot(aes(fill=Gender)) +
  ggtitle("Log(base10) Giving by Gender") +
  geom_jitter() +
  scale_x_discrete(name="Gender")+
  scale_y_continuous(name="Log(base 10) Giving") +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```
Of those that donate, men donate more. But we can't be sure this is significant as the median man donated less than the 75th percentile woman.

Try class year split by male and female:


```{r}
ggplot(dt,aes(factor(Class.Year),as.numeric(FY16GivingCat))) +
  geom_boxplot(aes(fill=Gender)) +
  ggtitle("Giving by Gender For each Class Year") +
  geom_jitter() +
  scale_x_discrete(name="Class Year")+
  scale_y_continuous(name="Giving Category",breaks=1:5,labels=c("[0,1)","[1,100)","[100,250)",
                                                                "[250,500)","[500,2e+05)")) +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```
So split by class year, gender does not seem to be a significant factor, and in fact older women donate more than older men

```{r}
ggplot(dt[FY16Giving>0],aes(factor(Class.Year),log10(FY16Giving))) +
  geom_boxplot(aes(fill=Gender)) +
  ggtitle("Log(base10) Giving by Class Year and Gender") +
  geom_jitter() +
  scale_x_discrete(name="Class Year")+
  scale_y_continuous(name="Log(base 10) Giving") +
  theme(plot.title = element_text(lineheight=1, face="bold")) 
```
SO limiting it to just alumni who donated in 2016, we do see that even split by age, men donated more than women, except for the oldest alumni